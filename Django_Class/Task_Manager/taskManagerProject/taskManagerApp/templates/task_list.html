{% extends 'master.html' %}

{% block body %}
<style>
  /* Your existing styles here */
</style>

<div class="tasks-wrapper">
  <h2 class="text-center mb-4 fw-bold text-primary">{{ user.fullname }}'s Tasks</h2>

  {% if tasks %}
    {% for task in tasks %}
    <div class="task-card">
      <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div class="flex-grow-1 pe-3">
          <h5 class="mb-1">{{ task.TaskTitle }}</h5>
          <p class="mb-2 text-muted">{{ task.TaskDescription|truncatechars:100 }}</p>
          <div class="d-flex flex-wrap gap-2">
            {% if task.TaskPriority == 'high' %}
              <span class="badge bg-danger">High Priority</span>
            {% elif task.TaskPriority == 'medium' %}
              <span class="badge bg-warning text-dark">Medium Priority</span>
            {% else %}
              <span class="badge bg-success">Low Priority</span>
            {% endif %}
            
            {% if task.TaskStatus == 'pending' %}
              <span class="badge bg-secondary">Pending</span>
            {% elif task.TaskStatus == 'inProgress' %}
              <span class="badge bg-info text-dark">In Progress</span>
            {% else %}
              <span class="badge bg-success">Completed</span>
            {% endif %}
            
            <span class="badge bg-light text-dark border">
              Due: {{ task.TaskDueDate }}
            </span>
          </div>
        </div>
        <div class="task-actions mt-3 mt-md-0">
          <!-- Button to trigger modal -->
          <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#taskModal{{ task.id }}">
            <i class="bi bi-eye"></i> View
          </button>
          <a href="{% url 'updateTask' task.id %}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-pencil"></i> Edit
          </a>
          <a href="{% url 'DeleteTask' task.id %}" class="btn btn-sm btn-outline-danger">
            <i class="bi bi-trash"></i> Delete
          </a>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="taskModal{{ task.id }}" tabindex="-1" aria-labelledby="taskModalLabel{{ task.id }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="taskModalLabel{{ task.id }}">{{ task.TaskTitle }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Description:</strong></p>
            <p>{{ task.TaskDescription }}</p>
            <p><strong>Priority:</strong> 
              {% if task.TaskPriority == 'high' %} High
              {% elif task.TaskPriority == 'medium' %} Medium
              {% else %} Low
              {% endif %}
            </p>
            <p><strong>Status:</strong> 
              {% if task.TaskStatus == 'pending' %} Pending
              {% elif task.TaskStatus == 'inProgress' %} In Progress
              {% else %} Completed
              {% endif %}
            </p>
            <p><strong>Due Date:</strong> {{ task.TaskDueDate }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    {% endfor %}
  {% else %}
    <p class="text-center text-muted">No tasks found.</p>
  {% endif %}
</div>

{% endblock %}
